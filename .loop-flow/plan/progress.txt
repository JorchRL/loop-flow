# Loop-Flow Development Progress

This file is an append-only log of development sessions **and learnings**.

- **Session log**: What was done, outcomes, blockers
- **Learning journal**: Edge cases, domain knowledge, tricks, non-obvious behaviors

---

## 2026-01-17 | Session 0 (Project Bootstrap)
Task: N/A (Design Session)
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Bootstrapped Loop-Flow project from design discussion in PROTOTYPE repo. Created:
- Project structure at ~/projects/loop-flow
- AGENTS.md with workflow rules
- docs/DESIGN.md with comprehensive architecture
- Initial backlog with 14 tasks across 4 phases
- Copied PROTOTYPE workflow files as reference

### Key Design Decisions

1. **Single global SQLite database** (~/.loop-flow/loop-flow.db) for all repos
2. **MCP as primary AI interface** - focused context returns, not file dumps
3. **"Loop" semantics** - explicit start/end for sessions
4. **Learnings as first-class entities** - searchable, tagged, cross-repo
5. **Minimal per-repo footprint** - optional .loopflow marker only
6. **TypeScript + Node.js** - matches target users, official MCP SDK

### Learnings

- **Context economy is the core insight**: Current file-based workflow grows unbounded. MCP server can return exactly what's needed.
- **Multi-repo from day one**: Design for it now, easier than retrofitting.
- **Team sync is valuable but complex**: Pin for future, don't overcomplicate MVP.

### Open Questions (for LF-001)

- How does Claude Code discover/connect to MCP servers?
- stdio vs HTTP transport?
- How to register custom tools?

---

## 2026-01-17 | Session 0b (Documentation)
Task: N/A (Continuation of bootstrap)
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Completed user-facing documentation for Loop-Flow:

1. **README.md** - User manual with:
   - Quick start for file-based workflow
   - "For Junior Developers" section with learning tips
   - Workflow file examples and formats
   - Task types and communication protocols
   - Migration path to MCP server

2. **SCAFFOLD.md** - Step-by-step setup guide:
   - Folder structure creation
   - Template files (backlog.json, progress.txt, AGENTS.md)
   - Example workflow walkthrough
   - Common pitfalls and solutions

3. **AGENTS.md updates** - Consolidated all rules from both PROTOTYPE files:
   - Philosophy and coding standards (from root AGENTS.md)
   - Session workflow mechanics (from .agents/AGENTS.md)
   - Complete backlog/progress schemas
   - Task prefixes and special types

### Files Created/Updated

- `README.md` (~250 lines) - User manual
- `SCAFFOLD.md` (~350 lines) - Setup instructions
- `AGENTS.md` (~200 lines) - Complete agent rules

### Learnings

- **Two-layer documentation**: README for users (why/what), SCAFFOLD for setup (how), AGENTS.md for AI (rules)
- **Junior-friendly framing**: Explain not just what to do, but why it helps them grow as engineers
- **Migration path matters**: Users need to know their work won't be lost when upgrading to MCP

### Next Session

Ready to start LF-001 (MCP Protocol Research) in the loop-flow folder.

---

## 2026-01-17 | Session 1 (Domain Model Analysis)
Task: LF-001.5 [DESIGN] Domain Model Analysis
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Socratic design session to analyze and refine Loop-Flow's domain model before implementation. Used the actual file-based workflow experience as input.

**Key outcomes:**

1. **Learning as Zettelkasten** — Learnings are first-class entities forming a knowledge graph, not just log entries. Links between insights are themselves insights.

2. **Leverage Hierarchy** — Not all learnings are equal:
   - `process` (highest) — how to work better
   - `domain` — problem space knowledge  
   - `architecture` — design decisions and rationale
   - `edge_case` — non-obvious behavior
   - `technical` (lower) — useful tricks

3. **Quick Capture vs Deep Synthesis** — Two modes for insights:
   - Quick: snapshot, mark unprocessed, schedule [DISCUSS], return to work
   - Deep: dedicated time for Socratic exploration and linking

4. **Theory Preservation** — Loop-Flow reframed as a "theory preservation system" (Naur). Code is artifact, theory is product.

5. **Created insights.json** — New file for structured, linkable learnings alongside progress.txt

### Files Created/Updated

- `docs/DESIGN.md` — Refined data model, learning types, link relations, MCP API updates
- `.agents/plan/insights.json` — New file with schema and 7 initial insights from this session
- `AGENTS.md` — Added insight capture protocol, [DISCUSS] task type, file locations
- `.agents/plan/backlog.json` — Marked LF-001.5 done, added LF-015 (scaling), LF-016 (quick capture)

### Learnings

See `.agents/plan/insights.json` for structured captures (INS-001 through INS-007).

Key insight: The workflow itself (Socratic discussion → crystallize → implement) is the highest-leverage process improvement. Loop-Flow's design was discovered this way.

### Next Session

Ready for LF-001 (MCP Protocol Research).

---

## 2026-01-17 | Session 1b (UX Discovery)
Task: LF-001.5 [DISCOVERY] UX Requirements
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Discovery session to extract UX requirements for Loop-Flow. Used rapid Q&A with interactive pickers to cover breadth fast.

**Key outcomes:**

1. **Cold Start UX** — Agent reminds user (not the other way around). Concise summary + interactive picker for next steps.

2. **Session End UX** — Trust by default. Autosave first, then show brief summary with insights captured. User can tweak after, not before. "See you next loop!"

3. **Mid-Task Flows**:
   - Subtasks: size-based judgment (small=do it, medium=ask, large=defer)
   - Insight capture: multiple entry points (prefix, agent notices, explicit command)
   - Blockers: different types get different responses
   - Context lookup: natural questions or explicit search, current project by default

4. **Conversation Modes** — Discovered four modes: Work, Discovery, Discuss, Review. They blend fluidly (agent reads the vibe). No meta-commentary in Work mode (preserve context).

5. **Discovery as distinct mode** — Different from Discuss. Discovery = breadth (extract requirements). Discuss = depth (synthesize insights).

### Files Created/Updated

- `docs/UX-REQUIREMENTS.md` — New file with all UX requirements from this session
- `.agents/plan/insights.json` — Added INS-008 through INS-013
- `AGENTS.md` — Added [DISCOVERY] task type, conversation modes section

### Learnings

See `.agents/plan/insights.json` for structured captures (INS-008 through INS-013).

Key insight: Interactive pickers (TUI questions) are better than prose for choices. One line of context, then picker. Discovery mode itself is a process improvement worth preserving.

### Next Session

Ready for LF-001 (MCP Protocol Research).

---

## 2026-01-17 | Session 2 (Bootstrap File)
Task: LF-001.6 [IMPL] Self-Contained Bootstrap File
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Created `LOOP-FLOW-BOOTSTRAP.md` — a self-contained file teammates can drop into any repo to scaffold Loop-Flow. Also renamed `.agents/` to `.loop-flow/` across the entire repo for consistency.

**Key outcomes:**

1. **Renamed `.agents/` → `.loop-flow/`** — More descriptive, matches the project name. Updated all references in AGENTS.md, SCAFFOLD.md, README.md, DESIGN.md.

2. **Created comprehensive bootstrap file** (~450 lines) including:
   - Step-by-step agent instructions
   - Full `.loop-flow/AGENTS.md` template with ALL concepts:
     - All task types (`[DESIGN]`, `[IMPL]`, `[SPIKE]`, `[REVIEW]`, `[BUG]`, `[DISCUSS]`, `[DISCOVERY]`)
     - Conversation modes (Work, Discovery, Discuss, Review) with fluid blending
     - Insight capture protocol (quick vs deep, leverage hierarchy)
     - Theory preservation framing (Naur)
     - "Backlog is a menu, not a queue"
     - Anti-patterns including context compaction
   - Templates for backlog.json, progress.txt, insights.json
   - Instructions for updating root AGENTS.md
   - Complete user tutorial

3. **Design decision**: Bootstrap files should optimize for completeness, not brevity. They're used once per project — length doesn't matter, knowledge transfer does.

### Files Created/Updated

- `LOOP-FLOW-BOOTSTRAP.md` — New self-contained bootstrap file (~450 lines)
- `.agents/` → `.loop-flow/` — Renamed folder
- `AGENTS.md` — Updated all `.agents` references to `.loop-flow`
- `SCAFFOLD.md` — Updated all `.agents` references to `.loop-flow`
- `README.md` — Updated all `.agents` references to `.loop-flow`
- `docs/DESIGN.md` — Updated all `.agents` references to `.loop-flow`
- `.loop-flow/plan/insights.json` — Added INS-014
- `.loop-flow/plan/backlog.json` — Added LF-001.6, updated notes

### Learnings

- **INS-014**: Terseness in bootstrap/scaffolding files is a form of pre-emptive context rot. You're compacting knowledge before it even reaches the new project. Bootstrap files are used once per project — length doesn't matter, completeness does.

- **INS-015**: Loop-Flow's secondary goal is fostering learning and growth toward becoming a great software engineer. This contrasts with "vibe coding" where AI does the thinking. AI should amplify human thinking, not replace it. The "developer has the reins" principle isn't just about control — it's about preserving the capacity to think deeply.

### Philosophy Updates

Wove the learning/growth philosophy throughout the docs:
- README.md: New intro emphasizing growth, updated "For Junior Developers" section, expanded Philosophy section
- AGENTS.md: Added "Foster Learning" workflow rule
- LOOP-FLOW-BOOTSTRAP.md: Updated Core Principles, User Tutorial with growth messaging

### How Teammates Use It

1. Download/copy `LOOP-FLOW-BOOTSTRAP.md` to their project
2. Tell AI: "Please scaffold Loop-Flow using LOOP-FLOW-BOOTSTRAP.md"
3. Agent creates everything, explains usage, deletes bootstrap file
4. Ready to start sessions

### Next Session

Ready for LF-001 (MCP Protocol Research).

---

## 2026-01-18 | Session 3 (MCP Research + Process Refinement)
Task: LF-001 [SPIKE] Research MCP Protocol
Outcome: IN_PROGRESS (substantial learning, not yet complete)
Manual QA: NOT_REQUIRED

### Summary

Learning session on MCP protocol that evolved into significant process and architecture refinements. True blend of Learn, Discuss, and Discovery modes — which itself became an insight.

**MCP Research Outcomes:**
- Understood Host/Client/Server architecture (host launches servers, creates client per server)
- Clarified the three primitives: Tools (model-controlled actions), Resources (app-controlled context), Prompts (user-triggered templates)
- Understood transports: stdio for local, HTTP+SSE for remote
- Identified context pollution concern: all tool definitions from all servers loaded into context
- Fetched and analyzed official MCP docs via llms.txt

**Architecture Decisions:**
- Local-first architecture confirmed (INS-017)
- Four-phase roadmap defined: Phase 0 (file-based bootstrap), Phase 1 (local MCP+SQLite), Phase 2 (web dashboard), Phase 3 (team/SaaS) — see INS-018
- Tools vs Resources distinction for Loop-Flow API design (INS-022)
- Two-tier context curation: embeddings for recall, LLM for judgment (INS-024)
- Domain knowledge index concept (llms.txt-style lazy loading) — INS-023

**Process Refinements:**
- Discovered Learn mode as distinct from Discovery and Discuss (INS-027)
- Clarified Modes vs Tasks: modes are vibes, tasks are explicit (INS-026)
- Probing questions during teaching (INS-016)
- Proactive insight surfacing (INS-019)
- Learning and discovery blend in generative loop (INS-025)

### Files Created/Updated

- `docs/DESIGN.md` — Rewrote Implementation Phases with four-phase roadmap and diagrams
- `docs/UX-REQUIREMENTS.md` — Added Learn mode, refined mode descriptions, added [LEARN] task type
- `AGENTS.md` — Added Learn mode, [LEARN] task type, refined mode descriptions
- `.loop-flow/plan/insights.json` — Added INS-016 through INS-027 (12 new insights!)
- `.loop-flow/plan/backlog.json` — Added LF-017 (Context Intelligence), LF-018 (Update Mechanism), LF-019 (Versioning)

### Insights Added

| ID | Type | Summary |
|----|------|---------|
| INS-016 | process | Probing questions guide active learning |
| INS-017 | architecture | Local-first architecture decision |
| INS-018 | architecture | Four-phase evolution roadmap |
| INS-019 | process | Proactively surface emerging insights |
| INS-020 | process | Periodic insight review sessions (unprocessed) |
| INS-021 | domain | Seek llms.txt-style knowledge hooks |
| INS-022 | architecture | MCP Tools vs Resources distinction |
| INS-023 | architecture | Domain knowledge index with lazy loading |
| INS-024 | architecture | Two-tier curation (embeddings + LLM) |
| INS-025 | process | Learning and discovery blend together |
| INS-026 | process | Modes are vibes, tasks are explicit |
| INS-027 | process | Learn mode definition |

### Still TODO for LF-001
- How to register MCP server with Claude Code
- Build hello-world MCP server
- Document findings in docs/MCP-RESEARCH.md

---

## 2026-01-18 | Session 3b (Update Mechanism)
Task: LF-018 [IMPL] Loop-Flow Update Mechanism
Outcome: COMPLETE (superseded by LF-020)
Manual QA: NOT_REQUIRED

### Summary

Created `LOOP-FLOW-UPDATE.md` — a file that lets agents update existing file-based Loop-Flow installations to the latest process knowledge. Later merged into unified setup file (LF-020).

---

## 2026-01-18 | Session 4 (Unified Setup File)
Task: LF-020 [IMPL] Unified Versioned Setup File
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Merged `LOOP-FLOW-BOOTSTRAP.md` and `LOOP-FLOW-UPDATE.md` into single `LOOP-FLOW-SETUP.md` (v0.3.0).

**Key features:**
- Auto-detects whether to bootstrap (fresh) or update (existing)
- Version number at top for quick reference
- Full changelog in VERSION HISTORY section
- One canonical AGENTS.md template (no duplication)
- Process insights tagged with `loop-flow-core` for methodology updates
- User tutorial section for fresh installs

**Design decisions:**
- Single file reduces confusion for distribution
- Auto-detect means users don't need to know which command to use
- Process insights carry Loop-Flow methodology forward; user insights stay separate
- Version history enables tracking what changed between updates

### Files Created/Updated

- `LOOP-FLOW-SETUP.md` — Unified setup file (~650 lines)
- Deleted: `LOOP-FLOW-BOOTSTRAP.md`, `LOOP-FLOW-UPDATE.md`
- `.loop-flow/plan/backlog.json` — Added LF-020, updated notes
- `.loop-flow/plan/insights.json` — Added INS-028

### Learnings

- **INS-028**: Bootstrap/setup files should be unified and versioned. Reduces confusion, ensures all installations can be brought to same version. Process insights tagged `loop-flow-core` carry methodology forward.

### Next Session

Continue LF-001.7: Claude Code registration and hello-world implementation.

---

## 2026-01-18 | Session 5 (Rename AGENTS.md to WORKFLOW.md)
Task: LF-021 [IMPL] Rename .loop-flow/AGENTS.md to WORKFLOW.md
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Renamed the Loop-Flow workflow rules file from `AGENTS.md` to `WORKFLOW.md` to avoid confusion with the repo's root `AGENTS.md`.

**Changes:**
- Updated LOOP-FLOW-SETUP.md: all references to `.loop-flow/AGENTS.md` → `.loop-flow/WORKFLOW.md`
- Bumped version to v0.4.0
- Added version history entry explaining the change
- Update path now handles renaming from old installations (v0.3.0 or earlier)
- Updated docs/DESIGN.md version

**Naming clarity:**
- Root `AGENTS.md` = repo-specific rules + "read Loop-Flow"
- `.loop-flow/WORKFLOW.md` = Loop-Flow methodology

**Additional change:** Properly dogfooded the structure:
- Created `.loop-flow/WORKFLOW.md` with full Loop-Flow methodology
- Slimmed root `AGENTS.md` to project-specific rules + pointer to Loop-Flow
- This repo now follows the same structure it prescribes to others

**Consistency pass:**
- Updated docs/DESIGN.md: fixed task type list in data model diagram
- Updated docs/UX-REQUIREMENTS.md: bumped version to 0.4.0
- Updated LOOP-FLOW-SETUP.md: fixed insights.json template version to 0.4.0
- All docs now consistent on: version (0.4.0), task types (8), file structure (WORKFLOW.md)

**Cleanup:**
- Deleted SCAFFOLD.md (obsolete, superseded by LOOP-FLOW-SETUP.md)
- Slimmed README.md to lightweight entry point (was duplicating LOOP-FLOW-SETUP.md content)
- README now: brief intro, links to setup/docs, philosophy, roadmap

**Discovery: Skills System**
- Meta-insight: version bumping is a repeatable skill with specific knowledge
- Two skill types emerged: Loop-Flow Core Skills (ship with LF) and User-Defined Skills (repo-specific)
- Created VERSION_MANIFEST.md as single source of truth for versioning
- Added LF-022 task to design the skills system architecture
- Captured as INS-029 (skills concept) and INS-030 (versioning skill)

### Learnings

- **INS-029**: Skills are reusable agent capabilities that encode specific knowledge. Two types: Core Skills (ship with Loop-Flow) and User-Defined Skills (repo-specific). Skills bridge generic agent capability and project-specific knowledge.
- **INS-030**: Versioning should have a single source of truth (VERSION_MANIFEST) that lists version, changelog, and all file references. The /version skill reads, updates, propagates, and verifies.

---

## 2026-01-20 | Session 6 (Version Bump v0.5.0)
Task: Ad-hoc version bump
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Bumped Loop-Flow from v0.4.0 to v0.5.0. Exported the update by adding 5 new process insights from the learn-tdd-go cross-pollination session.

**New process insights added (LF-PROC-007 to LF-PROC-011):**
- Spec-driven development: human writes specs, AI implements
- Human expertise is knowing WHAT to specify
- Verification functions pattern for testing
- Skills system concept (Core + User-Defined)
- Loop-Flow as learning platform vision

**Files updated:**
- VERSION_MANIFEST.md
- LOOP-FLOW-SETUP.md (version, template, new insights, VERSION HISTORY)
- .loop-flow/WORKFLOW.md
- docs/DESIGN.md
- docs/UX-REQUIREMENTS.md

The LOOP-FLOW-SETUP.md file is now ready for distribution to other projects.

---

## 2026-01-20 | Session 7 (Version Bump v0.6.0)
Task: Ad-hoc version bump
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Bumped Loop-Flow from v0.5.0 to v0.6.0 to include two new docs:

1. **docs/DISTRIBUTED-DISCOVERY.md** — Pattern for using AI agents as parallel interviewers to extract tacit knowledge from teams. Introduces MINILOOP.md concept: a lightweight, single-file Loop-Flow installation for feature branches.

2. **docs/PR-REVIEW-WORKFLOW.md** — Risk-focused code review workflow. Categorizes findings by deployment risk (critical/medium/low).

**Files updated:**
- VERSION_MANIFEST.md
- LOOP-FLOW-SETUP.md (version, template, new process insights LF-PROC-012/013, VERSION HISTORY)
- .loop-flow/WORKFLOW.md
- docs/DESIGN.md
- docs/UX-REQUIREMENTS.md
- .loop-flow/plan/insights.json (added INS-039, INS-040)
- .loop-flow/plan/backlog.json (notes)

### Learnings

- **INS-039**: Distributed Discovery / MINILOOP pattern — AI as parallel interviewer
- **INS-040**: Risk-focused PR review — categorize by deployment risk, not style

---

## 2026-01-20 | Session 8 (Skills System v0.7.0)
Task: Ad-hoc ergonomics improvement
Outcome: COMPLETE
Manual QA: NOT_REQUIRED

### Summary

Implemented Skills system for reliable session management:

1. **Research**: Investigated skill/command support across Claude Code, OpenCode, and Cursor
   - Claude Code: `.claude/skills/<name>/SKILL.md` with frontmatter
   - OpenCode: `.opencode/skills/<name>/SKILL.md` (same format - Agent Skills standard)
   - Cursor: `.cursor/rules/` for rules, commands via config

2. **Created Skills**:
   - `/start-loop`: Reads .loop-flow/ state directly, proposes tasks (solves glob failures)
   - `/end-loop`: Two modes — graceful handoff OR context emergency with RESUME.md

3. **Universal Approach**: Single SKILL.md format works in Claude Code + OpenCode

4. **Updated LOOP-FLOW-SETUP.md**: Added SKILL TEMPLATES section with full skill content

### Files Created/Updated

- `.claude/skills/start-loop/SKILL.md` — Start session skill
- `.claude/skills/end-loop/SKILL.md` — End session skill
- `.opencode/skills/start-loop/SKILL.md` — OpenCode copy
- `.opencode/skills/end-loop/SKILL.md` — OpenCode copy
- `LOOP-FLOW-SETUP.md` — Added skill templates, version bump to 0.7.0
- `VERSION_MANIFEST.md` — Added 0.7.0 changelog
- All version references updated to 0.7.0

### Learnings

- **INS-041**: Skills provide reliable session commands. Agent Skills standard works across Claude Code and OpenCode.

---
